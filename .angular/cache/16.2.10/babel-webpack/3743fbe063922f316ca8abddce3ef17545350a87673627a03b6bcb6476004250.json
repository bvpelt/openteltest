{"ast":null,"code":"/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nimport { isWrapped, InstrumentationBase } from '@opentelemetry/instrumentation';\nimport * as api from '@opentelemetry/api';\nimport { hrTime } from '@opentelemetry/core';\nimport { getElementXPath } from '@opentelemetry/sdk-trace-web';\nimport { AttributeNames } from './enums/AttributeNames';\nimport { VERSION } from './version';\nvar ZONE_CONTEXT_KEY = 'OT_ZONE_CONTEXT';\nvar EVENT_NAVIGATION_NAME = 'Navigation:';\nvar DEFAULT_EVENT_NAMES = ['click'];\nfunction defaultShouldPreventSpanCreation() {\n  return false;\n}\n/**\n * This class represents a UserInteraction plugin for auto instrumentation.\n * If zone.js is available then it patches the zone otherwise it patches\n * addEventListener of HTMLElement\n */\nvar UserInteractionInstrumentation = /** @class */function (_super) {\n  __extends(UserInteractionInstrumentation, _super);\n  function UserInteractionInstrumentation(config) {\n    var _a;\n    var _this = _super.call(this, '@opentelemetry/instrumentation-user-interaction', VERSION, config) || this;\n    _this.version = VERSION;\n    _this.moduleName = 'user-interaction';\n    _this._spansData = new WeakMap();\n    // for addEventListener/removeEventListener state\n    _this._wrappedListeners = new WeakMap();\n    // for event bubbling\n    _this._eventsSpanMap = new WeakMap();\n    _this._eventNames = new Set((_a = config === null || config === void 0 ? void 0 : config.eventNames) !== null && _a !== void 0 ? _a : DEFAULT_EVENT_NAMES);\n    _this._shouldPreventSpanCreation = typeof (config === null || config === void 0 ? void 0 : config.shouldPreventSpanCreation) === 'function' ? config.shouldPreventSpanCreation : defaultShouldPreventSpanCreation;\n    return _this;\n  }\n  UserInteractionInstrumentation.prototype.init = function () {};\n  /**\n   * This will check if last task was timeout and will save the time to\n   * fix the user interaction when nothing happens\n   * This timeout comes from xhr plugin which is needed to collect information\n   * about last xhr main request from observer\n   * @param task\n   * @param span\n   */\n  UserInteractionInstrumentation.prototype._checkForTimeout = function (task, span) {\n    var spanData = this._spansData.get(span);\n    if (spanData) {\n      if (task.source === 'setTimeout') {\n        spanData.hrTimeLastTimeout = hrTime();\n      } else if (task.source !== 'Promise.then' && task.source !== 'setTimeout') {\n        spanData.hrTimeLastTimeout = undefined;\n      }\n    }\n  };\n  /**\n   * Controls whether or not to create a span, based on the event type.\n   */\n  UserInteractionInstrumentation.prototype._allowEventName = function (eventName) {\n    return this._eventNames.has(eventName);\n  };\n  /**\n   * Creates a new span\n   * @param element\n   * @param eventName\n   * @param parentSpan\n   */\n  UserInteractionInstrumentation.prototype._createSpan = function (element, eventName, parentSpan) {\n    var _a;\n    if (!(element instanceof HTMLElement)) {\n      return undefined;\n    }\n    if (!element.getAttribute) {\n      return undefined;\n    }\n    if (element.hasAttribute('disabled')) {\n      return undefined;\n    }\n    if (!this._allowEventName(eventName)) {\n      return undefined;\n    }\n    var xpath = getElementXPath(element, true);\n    try {\n      var span = this.tracer.startSpan(eventName, {\n        attributes: (_a = {}, _a[AttributeNames.EVENT_TYPE] = eventName, _a[AttributeNames.TARGET_ELEMENT] = element.tagName, _a[AttributeNames.TARGET_XPATH] = xpath, _a[AttributeNames.HTTP_URL] = window.location.href, _a)\n      }, parentSpan ? api.trace.setSpan(api.context.active(), parentSpan) : undefined);\n      if (this._shouldPreventSpanCreation(eventName, element, span) === true) {\n        return undefined;\n      }\n      this._spansData.set(span, {\n        taskCount: 0\n      });\n      return span;\n    } catch (e) {\n      this._diag.error('failed to start create new user interaction span', e);\n    }\n    return undefined;\n  };\n  /**\n   * Decrement number of tasks that left in zone,\n   * This is needed to be able to end span when no more tasks left\n   * @param span\n   */\n  UserInteractionInstrumentation.prototype._decrementTask = function (span) {\n    var spanData = this._spansData.get(span);\n    if (spanData) {\n      spanData.taskCount--;\n      if (spanData.taskCount === 0) {\n        this._tryToEndSpan(span, spanData.hrTimeLastTimeout);\n      }\n    }\n  };\n  /**\n   * Return the current span\n   * @param zone\n   * @private\n   */\n  UserInteractionInstrumentation.prototype._getCurrentSpan = function (zone) {\n    var context = zone.get(ZONE_CONTEXT_KEY);\n    if (context) {\n      return api.trace.getSpan(context);\n    }\n    return context;\n  };\n  /**\n   * Increment number of tasks that are run within the same zone.\n   *     This is needed to be able to end span when no more tasks left\n   * @param span\n   */\n  UserInteractionInstrumentation.prototype._incrementTask = function (span) {\n    var spanData = this._spansData.get(span);\n    if (spanData) {\n      spanData.taskCount++;\n    }\n  };\n  /**\n   * Returns true iff we should use the patched callback; false if it's already been patched\n   */\n  UserInteractionInstrumentation.prototype.addPatchedListener = function (on, type, listener, wrappedListener) {\n    var listener2Type = this._wrappedListeners.get(listener);\n    if (!listener2Type) {\n      listener2Type = new Map();\n      this._wrappedListeners.set(listener, listener2Type);\n    }\n    var element2patched = listener2Type.get(type);\n    if (!element2patched) {\n      element2patched = new Map();\n      listener2Type.set(type, element2patched);\n    }\n    if (element2patched.has(on)) {\n      return false;\n    }\n    element2patched.set(on, wrappedListener);\n    return true;\n  };\n  /**\n   * Returns the patched version of the callback (or undefined)\n   */\n  UserInteractionInstrumentation.prototype.removePatchedListener = function (on, type, listener) {\n    var listener2Type = this._wrappedListeners.get(listener);\n    if (!listener2Type) {\n      return undefined;\n    }\n    var element2patched = listener2Type.get(type);\n    if (!element2patched) {\n      return undefined;\n    }\n    var patched = element2patched.get(on);\n    if (patched) {\n      element2patched.delete(on);\n      if (element2patched.size === 0) {\n        listener2Type.delete(type);\n        if (listener2Type.size === 0) {\n          this._wrappedListeners.delete(listener);\n        }\n      }\n    }\n    return patched;\n  };\n  // utility method to deal with the Function|EventListener nature of addEventListener\n  UserInteractionInstrumentation.prototype._invokeListener = function (listener, target, args) {\n    if (typeof listener === 'function') {\n      return listener.apply(target, args);\n    } else {\n      return listener.handleEvent(args[0]);\n    }\n  };\n  /**\n   * This patches the addEventListener of HTMLElement to be able to\n   * auto instrument the click events\n   * This is done when zone is not available\n   */\n  UserInteractionInstrumentation.prototype._patchAddEventListener = function () {\n    var plugin = this;\n    return function (original) {\n      return function addEventListenerPatched(type, listener, useCapture) {\n        // Forward calls with listener = null\n        if (!listener) {\n          return original.call(this, type, listener, useCapture);\n        }\n        // filter out null (typeof null === 'object')\n        var once = useCapture && typeof useCapture === 'object' && useCapture.once;\n        var patchedListener = function () {\n          var _this = this;\n          var args = [];\n          for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n          }\n          var parentSpan;\n          var event = args[0];\n          var target = event === null || event === void 0 ? void 0 : event.target;\n          if (event) {\n            parentSpan = plugin._eventsSpanMap.get(event);\n          }\n          if (once) {\n            plugin.removePatchedListener(this, type, listener);\n          }\n          var span = plugin._createSpan(target, type, parentSpan);\n          if (span) {\n            if (event) {\n              plugin._eventsSpanMap.set(event, span);\n            }\n            return api.context.with(api.trace.setSpan(api.context.active(), span), function () {\n              var result = plugin._invokeListener(listener, _this, args);\n              // no zone so end span immediately\n              span.end();\n              return result;\n            });\n          } else {\n            return plugin._invokeListener(listener, this, args);\n          }\n        };\n        if (plugin.addPatchedListener(this, type, listener, patchedListener)) {\n          return original.call(this, type, patchedListener, useCapture);\n        }\n      };\n    };\n  };\n  /**\n   * This patches the removeEventListener of HTMLElement to handle the fact that\n   * we patched the original callbacks\n   * This is done when zone is not available\n   */\n  UserInteractionInstrumentation.prototype._patchRemoveEventListener = function () {\n    var plugin = this;\n    return function (original) {\n      return function removeEventListenerPatched(type, listener, useCapture) {\n        var wrappedListener = plugin.removePatchedListener(this, type, listener);\n        if (wrappedListener) {\n          return original.call(this, type, wrappedListener, useCapture);\n        } else {\n          return original.call(this, type, listener, useCapture);\n        }\n      };\n    };\n  };\n  /**\n   * Most browser provide event listener api via EventTarget in prototype chain.\n   * Exception to this is IE 11 which has it on the prototypes closest to EventTarget:\n   *\n   * * - has addEventListener in IE\n   * ** - has addEventListener in all other browsers\n   * ! - missing in IE\n   *\n   * HTMLElement -> Element -> Node * -> EventTarget **! -> Object\n   * Document -> Node * -> EventTarget **! -> Object\n   * Window * -> WindowProperties ! -> EventTarget **! -> Object\n   */\n  UserInteractionInstrumentation.prototype._getPatchableEventTargets = function () {\n    return window.EventTarget ? [EventTarget.prototype] : [Node.prototype, Window.prototype];\n  };\n  /**\n   * Patches the history api\n   */\n  UserInteractionInstrumentation.prototype._patchHistoryApi = function () {\n    this._unpatchHistoryApi();\n    this._wrap(history, 'replaceState', this._patchHistoryMethod());\n    this._wrap(history, 'pushState', this._patchHistoryMethod());\n    this._wrap(history, 'back', this._patchHistoryMethod());\n    this._wrap(history, 'forward', this._patchHistoryMethod());\n    this._wrap(history, 'go', this._patchHistoryMethod());\n  };\n  /**\n   * Patches the certain history api method\n   */\n  UserInteractionInstrumentation.prototype._patchHistoryMethod = function () {\n    var plugin = this;\n    return function (original) {\n      return function patchHistoryMethod() {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        var url = \"\" + location.pathname + location.hash + location.search;\n        var result = original.apply(this, args);\n        var urlAfter = \"\" + location.pathname + location.hash + location.search;\n        if (url !== urlAfter) {\n          plugin._updateInteractionName(urlAfter);\n        }\n        return result;\n      };\n    };\n  };\n  /**\n   * unpatch the history api methods\n   */\n  UserInteractionInstrumentation.prototype._unpatchHistoryApi = function () {\n    if (isWrapped(history.replaceState)) this._unwrap(history, 'replaceState');\n    if (isWrapped(history.pushState)) this._unwrap(history, 'pushState');\n    if (isWrapped(history.back)) this._unwrap(history, 'back');\n    if (isWrapped(history.forward)) this._unwrap(history, 'forward');\n    if (isWrapped(history.go)) this._unwrap(history, 'go');\n  };\n  /**\n   * Updates interaction span name\n   * @param url\n   */\n  UserInteractionInstrumentation.prototype._updateInteractionName = function (url) {\n    var span = api.trace.getSpan(api.context.active());\n    if (span && typeof span.updateName === 'function') {\n      span.updateName(EVENT_NAVIGATION_NAME + \" \" + url);\n    }\n  };\n  /**\n   * Patches zone cancel task - this is done to be able to correctly\n   * decrement the number of remaining tasks\n   */\n  UserInteractionInstrumentation.prototype._patchZoneCancelTask = function () {\n    var plugin = this;\n    return function (original) {\n      return function patchCancelTask(task) {\n        var currentZone = Zone.current;\n        var currentSpan = plugin._getCurrentSpan(currentZone);\n        if (currentSpan && plugin._shouldCountTask(task, currentZone)) {\n          plugin._decrementTask(currentSpan);\n        }\n        return original.call(this, task);\n      };\n    };\n  };\n  /**\n   * Patches zone schedule task - this is done to be able to correctly\n   * increment the number of tasks running within current zone but also to\n   * save time in case of timeout running from xhr plugin when waiting for\n   * main request from PerformanceResourceTiming\n   */\n  UserInteractionInstrumentation.prototype._patchZoneScheduleTask = function () {\n    var plugin = this;\n    return function (original) {\n      return function patchScheduleTask(task) {\n        var currentZone = Zone.current;\n        var currentSpan = plugin._getCurrentSpan(currentZone);\n        if (currentSpan && plugin._shouldCountTask(task, currentZone)) {\n          plugin._incrementTask(currentSpan);\n          plugin._checkForTimeout(task, currentSpan);\n        }\n        return original.call(this, task);\n      };\n    };\n  };\n  /**\n   * Patches zone run task - this is done to be able to create a span when\n   * user interaction starts\n   * @private\n   */\n  UserInteractionInstrumentation.prototype._patchZoneRunTask = function () {\n    var plugin = this;\n    return function (original) {\n      return function patchRunTask(task, applyThis, applyArgs) {\n        var event = Array.isArray(applyArgs) && applyArgs[0] instanceof Event ? applyArgs[0] : undefined;\n        var target = event === null || event === void 0 ? void 0 : event.target;\n        var span;\n        var activeZone = this;\n        if (target) {\n          span = plugin._createSpan(target, task.eventName);\n          if (span) {\n            plugin._incrementTask(span);\n            return activeZone.run(function () {\n              try {\n                return api.context.with(api.trace.setSpan(api.context.active(), span), function () {\n                  var currentZone = Zone.current;\n                  task._zone = currentZone;\n                  return original.call(currentZone, task, applyThis, applyArgs);\n                });\n              } finally {\n                plugin._decrementTask(span);\n              }\n            });\n          }\n        } else {\n          span = plugin._getCurrentSpan(activeZone);\n        }\n        try {\n          return original.call(activeZone, task, applyThis, applyArgs);\n        } finally {\n          if (span && plugin._shouldCountTask(task, activeZone)) {\n            plugin._decrementTask(span);\n          }\n        }\n      };\n    };\n  };\n  /**\n   * Decides if task should be counted.\n   * @param task\n   * @param currentZone\n   * @private\n   */\n  UserInteractionInstrumentation.prototype._shouldCountTask = function (task, currentZone) {\n    if (task._zone) {\n      currentZone = task._zone;\n    }\n    if (!currentZone || !task.data || task.data.isPeriodic) {\n      return false;\n    }\n    var currentSpan = this._getCurrentSpan(currentZone);\n    if (!currentSpan) {\n      return false;\n    }\n    if (!this._spansData.get(currentSpan)) {\n      return false;\n    }\n    return task.type === 'macroTask' || task.type === 'microTask';\n  };\n  /**\n   * Will try to end span when such span still exists.\n   * @param span\n   * @param endTime\n   * @private\n   */\n  UserInteractionInstrumentation.prototype._tryToEndSpan = function (span, endTime) {\n    if (span) {\n      var spanData = this._spansData.get(span);\n      if (spanData) {\n        span.end(endTime);\n        this._spansData.delete(span);\n      }\n    }\n  };\n  /**\n   * implements enable function\n   */\n  UserInteractionInstrumentation.prototype.enable = function () {\n    var _this = this;\n    var ZoneWithPrototype = this.getZoneWithPrototype();\n    this._diag.debug('applying patch to', this.moduleName, this.version, 'zone:', !!ZoneWithPrototype);\n    if (ZoneWithPrototype) {\n      if (isWrapped(ZoneWithPrototype.prototype.runTask)) {\n        this._unwrap(ZoneWithPrototype.prototype, 'runTask');\n        this._diag.debug('removing previous patch from method runTask');\n      }\n      if (isWrapped(ZoneWithPrototype.prototype.scheduleTask)) {\n        this._unwrap(ZoneWithPrototype.prototype, 'scheduleTask');\n        this._diag.debug('removing previous patch from method scheduleTask');\n      }\n      if (isWrapped(ZoneWithPrototype.prototype.cancelTask)) {\n        this._unwrap(ZoneWithPrototype.prototype, 'cancelTask');\n        this._diag.debug('removing previous patch from method cancelTask');\n      }\n      this._zonePatched = true;\n      this._wrap(ZoneWithPrototype.prototype, 'runTask', this._patchZoneRunTask());\n      this._wrap(ZoneWithPrototype.prototype, 'scheduleTask', this._patchZoneScheduleTask());\n      this._wrap(ZoneWithPrototype.prototype, 'cancelTask', this._patchZoneCancelTask());\n    } else {\n      this._zonePatched = false;\n      var targets = this._getPatchableEventTargets();\n      targets.forEach(function (target) {\n        if (isWrapped(target.addEventListener)) {\n          _this._unwrap(target, 'addEventListener');\n          _this._diag.debug('removing previous patch from method addEventListener');\n        }\n        if (isWrapped(target.removeEventListener)) {\n          _this._unwrap(target, 'removeEventListener');\n          _this._diag.debug('removing previous patch from method removeEventListener');\n        }\n        _this._wrap(target, 'addEventListener', _this._patchAddEventListener());\n        _this._wrap(target, 'removeEventListener', _this._patchRemoveEventListener());\n      });\n    }\n    this._patchHistoryApi();\n  };\n  /**\n   * implements unpatch function\n   */\n  UserInteractionInstrumentation.prototype.disable = function () {\n    var _this = this;\n    var ZoneWithPrototype = this.getZoneWithPrototype();\n    this._diag.debug('removing patch from', this.moduleName, this.version, 'zone:', !!ZoneWithPrototype);\n    if (ZoneWithPrototype && this._zonePatched) {\n      if (isWrapped(ZoneWithPrototype.prototype.runTask)) {\n        this._unwrap(ZoneWithPrototype.prototype, 'runTask');\n      }\n      if (isWrapped(ZoneWithPrototype.prototype.scheduleTask)) {\n        this._unwrap(ZoneWithPrototype.prototype, 'scheduleTask');\n      }\n      if (isWrapped(ZoneWithPrototype.prototype.cancelTask)) {\n        this._unwrap(ZoneWithPrototype.prototype, 'cancelTask');\n      }\n    } else {\n      var targets = this._getPatchableEventTargets();\n      targets.forEach(function (target) {\n        if (isWrapped(target.addEventListener)) {\n          _this._unwrap(target, 'addEventListener');\n        }\n        if (isWrapped(target.removeEventListener)) {\n          _this._unwrap(target, 'removeEventListener');\n        }\n      });\n    }\n    this._unpatchHistoryApi();\n  };\n  /**\n   * returns Zone\n   */\n  UserInteractionInstrumentation.prototype.getZoneWithPrototype = function () {\n    var _window = window;\n    return _window.Zone;\n  };\n  return UserInteractionInstrumentation;\n}(InstrumentationBase);\nexport { UserInteractionInstrumentation };","map":{"version":3,"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","isWrapped","InstrumentationBase","api","hrTime","getElementXPath","AttributeNames","VERSION","ZONE_CONTEXT_KEY","EVENT_NAVIGATION_NAME","DEFAULT_EVENT_NAMES","defaultShouldPreventSpanCreation","UserInteractionInstrumentation","_super","config","_a","_this","version","moduleName","_spansData","WeakMap","_wrappedListeners","_eventsSpanMap","_eventNames","Set","eventNames","_shouldPreventSpanCreation","shouldPreventSpanCreation","init","_checkForTimeout","task","span","spanData","get","source","hrTimeLastTimeout","undefined","_allowEventName","eventName","has","_createSpan","element","parentSpan","HTMLElement","getAttribute","hasAttribute","xpath","tracer","startSpan","attributes","EVENT_TYPE","TARGET_ELEMENT","tagName","TARGET_XPATH","HTTP_URL","window","location","href","trace","setSpan","context","active","set","taskCount","e","_diag","error","_decrementTask","_tryToEndSpan","_getCurrentSpan","zone","getSpan","_incrementTask","addPatchedListener","on","type","listener","wrappedListener","listener2Type","Map","element2patched","removePatchedListener","patched","delete","size","_invokeListener","target","args","apply","handleEvent","_patchAddEventListener","plugin","original","addEventListenerPatched","useCapture","once","patchedListener","_i","arguments","length","event","with","result","end","_patchRemoveEventListener","removeEventListenerPatched","_getPatchableEventTargets","EventTarget","Node","Window","_patchHistoryApi","_unpatchHistoryApi","_wrap","history","_patchHistoryMethod","patchHistoryMethod","url","pathname","hash","search","urlAfter","_updateInteractionName","replaceState","_unwrap","pushState","back","forward","go","updateName","_patchZoneCancelTask","patchCancelTask","currentZone","Zone","current","currentSpan","_shouldCountTask","_patchZoneScheduleTask","patchScheduleTask","_patchZoneRunTask","patchRunTask","applyThis","applyArgs","isArray","Event","activeZone","run","_zone","data","isPeriodic","endTime","enable","ZoneWithPrototype","getZoneWithPrototype","debug","runTask","scheduleTask","cancelTask","_zonePatched","targets","forEach","addEventListener","removeEventListener","disable","_window"],"sources":["/home/bvpelt/Develop/openteltest/node_modules/@opentelemetry/auto-instrumentations-web/node_modules/@opentelemetry/instrumentation-user-interaction/build/esm/instrumentation.js"],"sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { isWrapped, InstrumentationBase } from '@opentelemetry/instrumentation';\nimport * as api from '@opentelemetry/api';\nimport { hrTime } from '@opentelemetry/core';\nimport { getElementXPath } from '@opentelemetry/sdk-trace-web';\nimport { AttributeNames } from './enums/AttributeNames';\nimport { VERSION } from './version';\nvar ZONE_CONTEXT_KEY = 'OT_ZONE_CONTEXT';\nvar EVENT_NAVIGATION_NAME = 'Navigation:';\nvar DEFAULT_EVENT_NAMES = ['click'];\nfunction defaultShouldPreventSpanCreation() {\n    return false;\n}\n/**\n * This class represents a UserInteraction plugin for auto instrumentation.\n * If zone.js is available then it patches the zone otherwise it patches\n * addEventListener of HTMLElement\n */\nvar UserInteractionInstrumentation = /** @class */ (function (_super) {\n    __extends(UserInteractionInstrumentation, _super);\n    function UserInteractionInstrumentation(config) {\n        var _a;\n        var _this = _super.call(this, '@opentelemetry/instrumentation-user-interaction', VERSION, config) || this;\n        _this.version = VERSION;\n        _this.moduleName = 'user-interaction';\n        _this._spansData = new WeakMap();\n        // for addEventListener/removeEventListener state\n        _this._wrappedListeners = new WeakMap();\n        // for event bubbling\n        _this._eventsSpanMap = new WeakMap();\n        _this._eventNames = new Set((_a = config === null || config === void 0 ? void 0 : config.eventNames) !== null && _a !== void 0 ? _a : DEFAULT_EVENT_NAMES);\n        _this._shouldPreventSpanCreation =\n            typeof (config === null || config === void 0 ? void 0 : config.shouldPreventSpanCreation) === 'function'\n                ? config.shouldPreventSpanCreation\n                : defaultShouldPreventSpanCreation;\n        return _this;\n    }\n    UserInteractionInstrumentation.prototype.init = function () { };\n    /**\n     * This will check if last task was timeout and will save the time to\n     * fix the user interaction when nothing happens\n     * This timeout comes from xhr plugin which is needed to collect information\n     * about last xhr main request from observer\n     * @param task\n     * @param span\n     */\n    UserInteractionInstrumentation.prototype._checkForTimeout = function (task, span) {\n        var spanData = this._spansData.get(span);\n        if (spanData) {\n            if (task.source === 'setTimeout') {\n                spanData.hrTimeLastTimeout = hrTime();\n            }\n            else if (task.source !== 'Promise.then' &&\n                task.source !== 'setTimeout') {\n                spanData.hrTimeLastTimeout = undefined;\n            }\n        }\n    };\n    /**\n     * Controls whether or not to create a span, based on the event type.\n     */\n    UserInteractionInstrumentation.prototype._allowEventName = function (eventName) {\n        return this._eventNames.has(eventName);\n    };\n    /**\n     * Creates a new span\n     * @param element\n     * @param eventName\n     * @param parentSpan\n     */\n    UserInteractionInstrumentation.prototype._createSpan = function (element, eventName, parentSpan) {\n        var _a;\n        if (!(element instanceof HTMLElement)) {\n            return undefined;\n        }\n        if (!element.getAttribute) {\n            return undefined;\n        }\n        if (element.hasAttribute('disabled')) {\n            return undefined;\n        }\n        if (!this._allowEventName(eventName)) {\n            return undefined;\n        }\n        var xpath = getElementXPath(element, true);\n        try {\n            var span = this.tracer.startSpan(eventName, {\n                attributes: (_a = {},\n                    _a[AttributeNames.EVENT_TYPE] = eventName,\n                    _a[AttributeNames.TARGET_ELEMENT] = element.tagName,\n                    _a[AttributeNames.TARGET_XPATH] = xpath,\n                    _a[AttributeNames.HTTP_URL] = window.location.href,\n                    _a),\n            }, parentSpan\n                ? api.trace.setSpan(api.context.active(), parentSpan)\n                : undefined);\n            if (this._shouldPreventSpanCreation(eventName, element, span) === true) {\n                return undefined;\n            }\n            this._spansData.set(span, {\n                taskCount: 0,\n            });\n            return span;\n        }\n        catch (e) {\n            this._diag.error('failed to start create new user interaction span', e);\n        }\n        return undefined;\n    };\n    /**\n     * Decrement number of tasks that left in zone,\n     * This is needed to be able to end span when no more tasks left\n     * @param span\n     */\n    UserInteractionInstrumentation.prototype._decrementTask = function (span) {\n        var spanData = this._spansData.get(span);\n        if (spanData) {\n            spanData.taskCount--;\n            if (spanData.taskCount === 0) {\n                this._tryToEndSpan(span, spanData.hrTimeLastTimeout);\n            }\n        }\n    };\n    /**\n     * Return the current span\n     * @param zone\n     * @private\n     */\n    UserInteractionInstrumentation.prototype._getCurrentSpan = function (zone) {\n        var context = zone.get(ZONE_CONTEXT_KEY);\n        if (context) {\n            return api.trace.getSpan(context);\n        }\n        return context;\n    };\n    /**\n     * Increment number of tasks that are run within the same zone.\n     *     This is needed to be able to end span when no more tasks left\n     * @param span\n     */\n    UserInteractionInstrumentation.prototype._incrementTask = function (span) {\n        var spanData = this._spansData.get(span);\n        if (spanData) {\n            spanData.taskCount++;\n        }\n    };\n    /**\n     * Returns true iff we should use the patched callback; false if it's already been patched\n     */\n    UserInteractionInstrumentation.prototype.addPatchedListener = function (on, type, listener, wrappedListener) {\n        var listener2Type = this._wrappedListeners.get(listener);\n        if (!listener2Type) {\n            listener2Type = new Map();\n            this._wrappedListeners.set(listener, listener2Type);\n        }\n        var element2patched = listener2Type.get(type);\n        if (!element2patched) {\n            element2patched = new Map();\n            listener2Type.set(type, element2patched);\n        }\n        if (element2patched.has(on)) {\n            return false;\n        }\n        element2patched.set(on, wrappedListener);\n        return true;\n    };\n    /**\n     * Returns the patched version of the callback (or undefined)\n     */\n    UserInteractionInstrumentation.prototype.removePatchedListener = function (on, type, listener) {\n        var listener2Type = this._wrappedListeners.get(listener);\n        if (!listener2Type) {\n            return undefined;\n        }\n        var element2patched = listener2Type.get(type);\n        if (!element2patched) {\n            return undefined;\n        }\n        var patched = element2patched.get(on);\n        if (patched) {\n            element2patched.delete(on);\n            if (element2patched.size === 0) {\n                listener2Type.delete(type);\n                if (listener2Type.size === 0) {\n                    this._wrappedListeners.delete(listener);\n                }\n            }\n        }\n        return patched;\n    };\n    // utility method to deal with the Function|EventListener nature of addEventListener\n    UserInteractionInstrumentation.prototype._invokeListener = function (listener, target, args) {\n        if (typeof listener === 'function') {\n            return listener.apply(target, args);\n        }\n        else {\n            return listener.handleEvent(args[0]);\n        }\n    };\n    /**\n     * This patches the addEventListener of HTMLElement to be able to\n     * auto instrument the click events\n     * This is done when zone is not available\n     */\n    UserInteractionInstrumentation.prototype._patchAddEventListener = function () {\n        var plugin = this;\n        return function (original) {\n            return function addEventListenerPatched(type, listener, useCapture) {\n                // Forward calls with listener = null\n                if (!listener) {\n                    return original.call(this, type, listener, useCapture);\n                }\n                // filter out null (typeof null === 'object')\n                var once = useCapture && typeof useCapture === 'object' && useCapture.once;\n                var patchedListener = function () {\n                    var _this = this;\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    var parentSpan;\n                    var event = args[0];\n                    var target = event === null || event === void 0 ? void 0 : event.target;\n                    if (event) {\n                        parentSpan = plugin._eventsSpanMap.get(event);\n                    }\n                    if (once) {\n                        plugin.removePatchedListener(this, type, listener);\n                    }\n                    var span = plugin._createSpan(target, type, parentSpan);\n                    if (span) {\n                        if (event) {\n                            plugin._eventsSpanMap.set(event, span);\n                        }\n                        return api.context.with(api.trace.setSpan(api.context.active(), span), function () {\n                            var result = plugin._invokeListener(listener, _this, args);\n                            // no zone so end span immediately\n                            span.end();\n                            return result;\n                        });\n                    }\n                    else {\n                        return plugin._invokeListener(listener, this, args);\n                    }\n                };\n                if (plugin.addPatchedListener(this, type, listener, patchedListener)) {\n                    return original.call(this, type, patchedListener, useCapture);\n                }\n            };\n        };\n    };\n    /**\n     * This patches the removeEventListener of HTMLElement to handle the fact that\n     * we patched the original callbacks\n     * This is done when zone is not available\n     */\n    UserInteractionInstrumentation.prototype._patchRemoveEventListener = function () {\n        var plugin = this;\n        return function (original) {\n            return function removeEventListenerPatched(type, listener, useCapture) {\n                var wrappedListener = plugin.removePatchedListener(this, type, listener);\n                if (wrappedListener) {\n                    return original.call(this, type, wrappedListener, useCapture);\n                }\n                else {\n                    return original.call(this, type, listener, useCapture);\n                }\n            };\n        };\n    };\n    /**\n     * Most browser provide event listener api via EventTarget in prototype chain.\n     * Exception to this is IE 11 which has it on the prototypes closest to EventTarget:\n     *\n     * * - has addEventListener in IE\n     * ** - has addEventListener in all other browsers\n     * ! - missing in IE\n     *\n     * HTMLElement -> Element -> Node * -> EventTarget **! -> Object\n     * Document -> Node * -> EventTarget **! -> Object\n     * Window * -> WindowProperties ! -> EventTarget **! -> Object\n     */\n    UserInteractionInstrumentation.prototype._getPatchableEventTargets = function () {\n        return window.EventTarget\n            ? [EventTarget.prototype]\n            : [Node.prototype, Window.prototype];\n    };\n    /**\n     * Patches the history api\n     */\n    UserInteractionInstrumentation.prototype._patchHistoryApi = function () {\n        this._unpatchHistoryApi();\n        this._wrap(history, 'replaceState', this._patchHistoryMethod());\n        this._wrap(history, 'pushState', this._patchHistoryMethod());\n        this._wrap(history, 'back', this._patchHistoryMethod());\n        this._wrap(history, 'forward', this._patchHistoryMethod());\n        this._wrap(history, 'go', this._patchHistoryMethod());\n    };\n    /**\n     * Patches the certain history api method\n     */\n    UserInteractionInstrumentation.prototype._patchHistoryMethod = function () {\n        var plugin = this;\n        return function (original) {\n            return function patchHistoryMethod() {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i] = arguments[_i];\n                }\n                var url = \"\" + location.pathname + location.hash + location.search;\n                var result = original.apply(this, args);\n                var urlAfter = \"\" + location.pathname + location.hash + location.search;\n                if (url !== urlAfter) {\n                    plugin._updateInteractionName(urlAfter);\n                }\n                return result;\n            };\n        };\n    };\n    /**\n     * unpatch the history api methods\n     */\n    UserInteractionInstrumentation.prototype._unpatchHistoryApi = function () {\n        if (isWrapped(history.replaceState))\n            this._unwrap(history, 'replaceState');\n        if (isWrapped(history.pushState))\n            this._unwrap(history, 'pushState');\n        if (isWrapped(history.back))\n            this._unwrap(history, 'back');\n        if (isWrapped(history.forward))\n            this._unwrap(history, 'forward');\n        if (isWrapped(history.go))\n            this._unwrap(history, 'go');\n    };\n    /**\n     * Updates interaction span name\n     * @param url\n     */\n    UserInteractionInstrumentation.prototype._updateInteractionName = function (url) {\n        var span = api.trace.getSpan(api.context.active());\n        if (span && typeof span.updateName === 'function') {\n            span.updateName(EVENT_NAVIGATION_NAME + \" \" + url);\n        }\n    };\n    /**\n     * Patches zone cancel task - this is done to be able to correctly\n     * decrement the number of remaining tasks\n     */\n    UserInteractionInstrumentation.prototype._patchZoneCancelTask = function () {\n        var plugin = this;\n        return function (original) {\n            return function patchCancelTask(task) {\n                var currentZone = Zone.current;\n                var currentSpan = plugin._getCurrentSpan(currentZone);\n                if (currentSpan && plugin._shouldCountTask(task, currentZone)) {\n                    plugin._decrementTask(currentSpan);\n                }\n                return original.call(this, task);\n            };\n        };\n    };\n    /**\n     * Patches zone schedule task - this is done to be able to correctly\n     * increment the number of tasks running within current zone but also to\n     * save time in case of timeout running from xhr plugin when waiting for\n     * main request from PerformanceResourceTiming\n     */\n    UserInteractionInstrumentation.prototype._patchZoneScheduleTask = function () {\n        var plugin = this;\n        return function (original) {\n            return function patchScheduleTask(task) {\n                var currentZone = Zone.current;\n                var currentSpan = plugin._getCurrentSpan(currentZone);\n                if (currentSpan && plugin._shouldCountTask(task, currentZone)) {\n                    plugin._incrementTask(currentSpan);\n                    plugin._checkForTimeout(task, currentSpan);\n                }\n                return original.call(this, task);\n            };\n        };\n    };\n    /**\n     * Patches zone run task - this is done to be able to create a span when\n     * user interaction starts\n     * @private\n     */\n    UserInteractionInstrumentation.prototype._patchZoneRunTask = function () {\n        var plugin = this;\n        return function (original) {\n            return function patchRunTask(task, applyThis, applyArgs) {\n                var event = Array.isArray(applyArgs) && applyArgs[0] instanceof Event\n                    ? applyArgs[0]\n                    : undefined;\n                var target = event === null || event === void 0 ? void 0 : event.target;\n                var span;\n                var activeZone = this;\n                if (target) {\n                    span = plugin._createSpan(target, task.eventName);\n                    if (span) {\n                        plugin._incrementTask(span);\n                        return activeZone.run(function () {\n                            try {\n                                return api.context.with(api.trace.setSpan(api.context.active(), span), function () {\n                                    var currentZone = Zone.current;\n                                    task._zone = currentZone;\n                                    return original.call(currentZone, task, applyThis, applyArgs);\n                                });\n                            }\n                            finally {\n                                plugin._decrementTask(span);\n                            }\n                        });\n                    }\n                }\n                else {\n                    span = plugin._getCurrentSpan(activeZone);\n                }\n                try {\n                    return original.call(activeZone, task, applyThis, applyArgs);\n                }\n                finally {\n                    if (span && plugin._shouldCountTask(task, activeZone)) {\n                        plugin._decrementTask(span);\n                    }\n                }\n            };\n        };\n    };\n    /**\n     * Decides if task should be counted.\n     * @param task\n     * @param currentZone\n     * @private\n     */\n    UserInteractionInstrumentation.prototype._shouldCountTask = function (task, currentZone) {\n        if (task._zone) {\n            currentZone = task._zone;\n        }\n        if (!currentZone || !task.data || task.data.isPeriodic) {\n            return false;\n        }\n        var currentSpan = this._getCurrentSpan(currentZone);\n        if (!currentSpan) {\n            return false;\n        }\n        if (!this._spansData.get(currentSpan)) {\n            return false;\n        }\n        return task.type === 'macroTask' || task.type === 'microTask';\n    };\n    /**\n     * Will try to end span when such span still exists.\n     * @param span\n     * @param endTime\n     * @private\n     */\n    UserInteractionInstrumentation.prototype._tryToEndSpan = function (span, endTime) {\n        if (span) {\n            var spanData = this._spansData.get(span);\n            if (spanData) {\n                span.end(endTime);\n                this._spansData.delete(span);\n            }\n        }\n    };\n    /**\n     * implements enable function\n     */\n    UserInteractionInstrumentation.prototype.enable = function () {\n        var _this = this;\n        var ZoneWithPrototype = this.getZoneWithPrototype();\n        this._diag.debug('applying patch to', this.moduleName, this.version, 'zone:', !!ZoneWithPrototype);\n        if (ZoneWithPrototype) {\n            if (isWrapped(ZoneWithPrototype.prototype.runTask)) {\n                this._unwrap(ZoneWithPrototype.prototype, 'runTask');\n                this._diag.debug('removing previous patch from method runTask');\n            }\n            if (isWrapped(ZoneWithPrototype.prototype.scheduleTask)) {\n                this._unwrap(ZoneWithPrototype.prototype, 'scheduleTask');\n                this._diag.debug('removing previous patch from method scheduleTask');\n            }\n            if (isWrapped(ZoneWithPrototype.prototype.cancelTask)) {\n                this._unwrap(ZoneWithPrototype.prototype, 'cancelTask');\n                this._diag.debug('removing previous patch from method cancelTask');\n            }\n            this._zonePatched = true;\n            this._wrap(ZoneWithPrototype.prototype, 'runTask', this._patchZoneRunTask());\n            this._wrap(ZoneWithPrototype.prototype, 'scheduleTask', this._patchZoneScheduleTask());\n            this._wrap(ZoneWithPrototype.prototype, 'cancelTask', this._patchZoneCancelTask());\n        }\n        else {\n            this._zonePatched = false;\n            var targets = this._getPatchableEventTargets();\n            targets.forEach(function (target) {\n                if (isWrapped(target.addEventListener)) {\n                    _this._unwrap(target, 'addEventListener');\n                    _this._diag.debug('removing previous patch from method addEventListener');\n                }\n                if (isWrapped(target.removeEventListener)) {\n                    _this._unwrap(target, 'removeEventListener');\n                    _this._diag.debug('removing previous patch from method removeEventListener');\n                }\n                _this._wrap(target, 'addEventListener', _this._patchAddEventListener());\n                _this._wrap(target, 'removeEventListener', _this._patchRemoveEventListener());\n            });\n        }\n        this._patchHistoryApi();\n    };\n    /**\n     * implements unpatch function\n     */\n    UserInteractionInstrumentation.prototype.disable = function () {\n        var _this = this;\n        var ZoneWithPrototype = this.getZoneWithPrototype();\n        this._diag.debug('removing patch from', this.moduleName, this.version, 'zone:', !!ZoneWithPrototype);\n        if (ZoneWithPrototype && this._zonePatched) {\n            if (isWrapped(ZoneWithPrototype.prototype.runTask)) {\n                this._unwrap(ZoneWithPrototype.prototype, 'runTask');\n            }\n            if (isWrapped(ZoneWithPrototype.prototype.scheduleTask)) {\n                this._unwrap(ZoneWithPrototype.prototype, 'scheduleTask');\n            }\n            if (isWrapped(ZoneWithPrototype.prototype.cancelTask)) {\n                this._unwrap(ZoneWithPrototype.prototype, 'cancelTask');\n            }\n        }\n        else {\n            var targets = this._getPatchableEventTargets();\n            targets.forEach(function (target) {\n                if (isWrapped(target.addEventListener)) {\n                    _this._unwrap(target, 'addEventListener');\n                }\n                if (isWrapped(target.removeEventListener)) {\n                    _this._unwrap(target, 'removeEventListener');\n                }\n            });\n        }\n        this._unpatchHistoryApi();\n    };\n    /**\n     * returns Zone\n     */\n    UserInteractionInstrumentation.prototype.getZoneWithPrototype = function () {\n        var _window = window;\n        return _window.Zone;\n    };\n    return UserInteractionInstrumentation;\n}(InstrumentationBase));\nexport { UserInteractionInstrumentation };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}